{% extends 'base.html.twig' %}

{% block title %}Afficher graphe{% endblock %}

{% block body %}

<div class="main">
<div class="header"><h2>Afficher graphe</h2></div>
<form id="grapheForm">
    <label>Entrez l'anée</label><input type="text" name="year" placeholder="Exemple: 2015">
    <input id="btn_envoyer" type="submit"></input>
</form>

<div class="container">
    <canvas id="myChart"></canvas>
</div>

</div>
{% endblock %}

{% block javascripts %}
<script src="https://unpkg.com/axios/dist/axios.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.3/Chart.min.js"></script>

<script>
    btn_envoyer.addEventListener("click", (event) =>{
        event.preventDefault();
        console.log("totot");

        axios ({
            url : '{{ path ("afficher_graphe") }}',
            method : 'POST',
            headers: {'Content-Type': 'multipart/form-data'},
            data: new FormData (document.getElementById('grapheForm'))
        })
        .then(function (response){
            let prestations = response.data;
            let arrayServices = Object.keys(prestations);
            let arrayValeur = Object.values(prestations);

            
    let myChart = document.getElementById('myChart').getContext('2d');
    
    let servicesChart = new Chart(myChart,{
        type:'bar',
        data:{
            labels: arrayServices,
            datasets:[{
                label: 'Montant en € gagné par service',
                data: arrayValeur,
                backgroundColor:[
                    'rgba(255, 99, 132, 0.6)',
                    'rgba(54, 162, 235, 0.6)',
                    'rgba(255, 206, 86, 0.6)',
                    'rgba(75, 192, 192, 0.6)',
                    'rgba(153, 102, 255, 0.6)',
                    'rgba(255, 159, 64, 0.6)',
                    'rgba(255, 99, 132, 0.6)',
                ],
                borderWidth:1,
                borderColor: '#777',
                hoverBorderwidth: 4,
                hoverBorderColor: '#000'
            }]
        },
        options:{
            title:{
                display:true,
                text:'Representation des chiffres d\'affaires pour chaque service pendant un an',
                fontSize:20
            },
            legend:{
                display:false
            }
        }
    });
    })
    .catch(function (error){
        console.log(error);
    });
});
    
</script>


{% endblock %}